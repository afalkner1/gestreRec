<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
$(document).ready(function () {
    resetForms();
});

function resetForms() {
    document.forms['myForm'].reset();
}

</script>



<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    body {font-family: Arial;}
    
    /* Style the tab */
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
    }
    
    /* Style the buttons inside the tab */
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 17px;
    }
    
    /* Change background color of buttons on hover */
    .tab button:hover {
      background-color: #ddd;
    }
    
    /* Create an active/current tablink class */
    .tab button.active {
      background-color: #ccc;
    }
    
    /* Style the tab content */
    .tabcontent {
      display: none;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-top: none;
    }

    body {
        {#font-family: Georgia, "Times New Roman",#}
        {#  Times, serif;#}
        background-color: #c8d8e4
    }

    .title {
        {#font-family: Helvetica, Geneva, Arial, SunSans-Regular, sans-serif;#}
        background-color: #2b6777;
        text-align: center;

    }
    h1{
        font-family: Andale Mono, monospace;
        font-size: 60px;
        color: #ffffff;
        font-variant: small-caps;


    }
    p {
        font-family: Andale Mono, monospace;
        font-size: 20px;
        color: #f2f2f2;
    }

    .container{
        padding: 10px;
    }

    .form-inline{
      padding: 10px;
        font-family: Andale Mono, monospace;
        font-size: 13px;
        color: #f2f2f2;
    }
    .image{
        {#position: absolute;#}
        {#left: 0px;#}
        {#margin-top: 80px;#}
    }


</style>
</head>


<body>
<div class ="title">
    <title>Gesture recognition</title>
{#    <link rel="stylesheet" href="templates/style.css">#}
    <div class = "image">
        <img src="https://i.postimg.cc/j2SCw9bd/Dance-Rec-7-removebg-preview.png" height="30%">
    </div>
    <h1>How well can you dance?</h1>

    
    <div class="tab">
      <button class="tablinks" onclick="openCity(event, 'Score YouTube')">Score YouTube</button>
      <button class="tablinks" onclick="openCity(event, 'Webcam')">Webcam</button>
      <button class="tablinks" onclick="openCity(event, 'Train')">Train</button>
    </div>
    
    <div id="Score YouTube" class="tabcontent">
      <h3>Score YouTube</h3>
      <p> Input your youtube link, and then receive your dance score.</p>
      <div class="form-inline">
      <form method="POST" name="myForm">
          <input name="YouTube URL">
          <input type="submit">
  
          <label for="dances">Choose a dance:</label>
          <select name="dances" id="dances">
              <option value="onda">Onda</option>
              <option value="control">Controller Crew</option>
              <option value="bounce">Billy Bounce</option>
              <option value="hitit">Hit it</option>
          </select>
  {#        <button name="Stop Video" type="submit" value="Stop">Stop</button>#}
      </form>
          <form action="{{ url_for('currentstatus') }}"
               <input type="submit" value="Stop" />
          </form>
          <button type="button" onclick="window.location.href='{{ url_for( 'currentstatus'  ) }}';">Scores</button>
          <img src="{{ url_for('video_feed') }}" width="80%" class = center>
      </div>
  </div>
  
      <!-- <div class="container">
          <div class="row">
  {#            <div class="col-lg-8  offset-lg-2">#}
              <div style="text-align: center;">
                  <img src="{{ url_for('video_feed') }}" width="80%" class = center>
              </div>
          </div>
      </div> -->

      
    </div>
    


    <div id="Webcam" class="tabcontent">
      <h3>Webcam</h3>
      <p>Webcam is the capital of France.</p> 
      <img src="{{ url_for('webcam') }}" width="80%" class = center>
    </div>
    
    <div id="Train" class="tabcontent">
      <h3>Train</h3>
      <p>Train is the capital of Japan.</p>
      <div class="grid-container" id="camera_container">
        <!-- <div class="item1" id="container" ><video autoplay="true" id="video"></video></div> -->
        <div class="item1" id="container" ><video autoplay="false" id="video"></video></div>
        <div class="item2"><button id="startbutton" class="capture_button">Capture</button></div>
        <div class="item3"><button class="light_switch">Light</button></div>  
        <!-- <div class="item4">button3</div>
        <div class="item5">button4</div> -->
      </div>
      
      
        <h1 class="hidden">
        <canvas id="canvas"></canvas>
      
        <div class="output">
          <img id="photo" alt="The screen capture will appear in this box."> 
        </div> 
      
      </h1> 
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">
        var width = 320;    // We will scale the photo width to this
        var height = 0;     // This will be computed based on the input stream
        var streaming = false;
        var socket = io();
        socket.on('connect', function() {
            socket.emit('json', {data: 'I\'m connected!'});
            console.log('connected')
        });

        function openCity(evt, cityName) {
          var i, tabcontent, tablinks;
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          tablinks = document.getElementsByClassName("tablinks");
          for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
          document.getElementById(cityName).style.display = "block";
          evt.currentTarget.className += " active";
        }

        function startup() {
      window.scrollTo(0,1);
      video = document.getElementById('video');
      canvas = document.getElementById('canvas');
      photo = document.getElementById('photo');
      startbutton = document.getElementById('startbutton');

      //Get the environment camera (usually the second one)
      navigator.mediaDevices.getUserMedia({
      video: {
        // deviceId: camera.deviceId,
        facingMode: [ 'user'], // environment
        height: {ideal: 395},
        width: {ideal: 700}
      }
    }).then(stream => {
        video.srcObject = stream;
        video.play();
        const track = stream.getVideoTracks()[0];
        var torchOn = false;
        function torchOff(){
          var torchOn = false;
          track.applyConstraints({advanced: [{torch: false}] });
        };

        // https://googlechrome.github.io/samples/image-capture/update-camera-zoom.html
        track.applyConstraints({advanced: [{torch: torchOn,zoom: 1}]});
        const btn = document.querySelector('.light_switch');
        btn.addEventListener('click', function(){
            torchOn = !torchOn;
            track.applyConstraints({
            advanced: [{torch: torchOn}]
          });
          window.navigator.vibrate(200);
          setTimeout(torchOff, 30000); // torch to turn off in 30s
        });
      })
      .catch(function(err) {
        console.log("An error occurred: " + err);
      });
  
      video.addEventListener('canplay', function(ev){
        if (!streaming) {
          height = video.videoHeight / (video.videoWidth/width);
          if (isNaN(height)) {
            height = width / (4/3);
          }
          video.setAttribute('width', width);
          video.setAttribute('height', height);
          canvas.setAttribute('width', width);
          canvas.setAttribute('height', height);
          streaming = true;
        }
      }, false);
  
      startbutton.addEventListener('click', function(ev){
        window.navigator.vibrate(200);
        takepicture("capture.png");
        // changeBackgroundColor();
        ev.preventDefault();
      }, false);
      
      clearphoto();



    }

    function clearphoto() {
      var context = canvas.getContext('2d');
      context.fillStyle = "#AAA";
      context.fillRect(0, 0, canvas.width, canvas.height);
  
      var data = canvas.toDataURL('image/png');
      photo.setAttribute('src', data);
    }

    var cam_int = 0;
    function takepicture(fname) {
      
      var context = canvas.getContext('2d');
      if (width && height) {
        canvas.width = width;
        canvas.height = height;
        context.drawImage(video, 0, 0, width, height);
      
        var data = canvas.toDataURL('image/png');
        photo.setAttribute('src', data);
        console.log("sending image  " + fname);
        sendBase64ToServer(fname, data);
      } else {
        clearphoto();
      }
      cam_int = cam_int + 1;
      setTimeout(() => {  
        takepicture();
      }, 10);
    }

        window.addEventListener('load', startup, false);




// Here we define the function that will send the request to the server. 
// It will accept the image name, and the base64 data as arguments

var sendBase64ToServer = function(name, base64){
  var currentHost = window.location.host;
  console.log("currentHost  " + currentHost);
//   var httpPost = new XMLHttpRequest(),
//       path = "https://"  + location.host +  "/uploadImage/" + name,
      jsdata = JSON.stringify({image: base64});
      var time = new Date();

      socket.emit('json', {data: jsdata, 'epoch':time.getTime(),'seconds':time.getSeconds(),'milliseconds':time.getMilliseconds()});
      console.log(cam_int); 
// httpPost.open("POST", path, true);
// httpPost.send(data);
};

// This wrapper function will accept the name of the image, the url, and the 
// image type and perform the request

// var uploadImage = function(src, name, type){
//   console.log("upload image");
//   convertToBase64(src, type, function(data){
//     sendBase64ToServer(name, data);
// });
// };
        </script>
</body>